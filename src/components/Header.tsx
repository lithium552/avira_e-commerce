import { useEffect } from 'react'
import { useSelector, useDispatch } from 'react-redux'
import { selectFavoriteProducts } from '../features/products/productsSlice'
import { fetchAllProducts } from '../features/products/allProductsSlice'
import { Link } from 'react-router-dom'
import { currentUser } from '../features/user'
import { userLogout, cleanUp } from '../features/user'
import Navigation from './Navigation'
import { AppDispatch, RootState } from '../app/store'


const Header = () => {
  const cartCounter = useSelector((state: RootState) => state.cart.cart.length)
  const status = useSelector((state: RootState) => state.allProducts.status)
  const user = useSelector(currentUser)
  const favorite = useSelector(selectFavoriteProducts)
  const dispatch = useDispatch<AppDispatch>()
  const logOut = () => {
    dispatch(userLogout())
    dispatch(cleanUp(null))
    localStorage.removeItem('user')
    localStorage.removeItem('cartItems')
  }


  useEffect(() => {
    if (status === 'idle') dispatch(fetchAllProducts())
  }, [])

  return (
    <header className='shadow-[0_1px_2px_0_rgba(0,0,0,0.25)]'>
      <section className='flex py-4 px-14 justify-between items-center '>
        <div>
          <svg width="80" height="68" viewBox="0 0 80 68" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g clipPath="url(#clip0_29_2879)">
              <rect width="80" height="68" fill="white" />
              <g clipPath="url(#clip1_29_2879)">
                <g clipPath="url(#clip2_29_2879)">
                  <g clipPath="url(#clip3_29_2879)">
                    <g clipPath="url(#clip4_29_2879)">
                      <g clipPath="url(#clip5_29_2879)">
                        <g clipPath="url(#clip6_29_2879)">
                          <g clipPath="url(#clip7_29_2879)">
                            <path d="M17.4779 41.3006L19.1963 41.5941L19.1721 42.9395H10.4103L10.2651 42.1567C10.8298 41.7164 11.4349 41.3332 12.0804 41.0071L11.33 38.9767H6.39242L5.54528 41.2517L7.50581 41.5941L7.4816 42.9395H0.535056L0.389832 42.1567C0.938456 41.7164 1.61617 41.2924 2.42297 40.8847L7.4332 28.3115L7.02173 27.1618L11.4269 26.061L17.4779 41.3006ZM7.21536 36.7263H10.5071L8.86123 32.2009L7.21536 36.7263ZM31.3467 31.149L31.371 32.4455L30.306 33.1794L27.3773 40.3711L26.2881 42.8661C25.6104 43.0618 24.7149 43.1597 23.6015 43.1597C22.9399 43.1597 22.3832 43.1189 21.9314 43.0374L18.4218 33.5952L16.8486 32.5189V31.149H22.7785L24.5696 36.9709L24.9085 38.5854H25.1747C25.4974 36.2044 25.7476 33.7257 25.9251 31.149H31.3467ZM35.9213 29.6569C34.6143 29.0535 33.5412 28.2218 32.7022 27.1618C33.396 25.8083 34.2916 24.7075 35.3888 23.8595C36.6152 24.5607 37.6317 25.5066 38.4385 26.697C37.8253 27.9038 36.9863 28.8904 35.9213 29.6569ZM38.0997 31.9318V40.7869C38.7935 41.0804 39.3744 41.3984 39.8424 41.7409L39.8181 42.9395H31.4194L31.3952 42.0834C31.9115 41.7572 32.5247 41.4555 33.2347 41.1783V33.2527L31.4194 32.788L31.371 31.5894C32.92 31.0349 34.6869 30.7169 36.6716 30.6354L38.0997 31.9318ZM52.9319 32.7635L49.9064 36.5061C48.7123 35.4624 47.7441 34.8672 47.0019 34.7204V40.4934C48.1314 40.9011 49.027 41.3169 49.6885 41.7409L49.6643 42.9395H40.3458L40.3216 42.0834C40.8702 41.7409 41.4753 41.4474 42.1369 41.2027V33.2527L40.3216 32.788L40.2732 31.5894C41.8222 31.0349 43.5891 30.7169 45.5739 30.6354L47.0019 32.788L48.6962 30.7821C49.0028 30.6843 49.3416 30.6354 49.7127 30.6354C50.4389 30.6354 51.1085 30.8262 51.7217 31.2078C52.3348 31.5926 52.7382 32.1112 52.9319 32.7635ZM66.0746 40.2487L66.1473 41.3495L62.6861 43.3554C61.5888 43.3554 60.6852 42.752 59.9752 41.5452L57.458 43.2331L56.5383 43.3064C55.4572 43.3064 54.5535 42.9836 53.8274 42.3378C53.1013 41.6952 52.7382 40.9418 52.7382 40.0775C52.7382 39.5231 52.9125 38.9735 53.261 38.4288C53.6064 37.8809 54.1179 37.4357 54.7956 37.0932L59.3459 36.9954V35.1607C59.3459 33.954 58.9829 33.1549 58.2568 32.7635C57.9018 32.7961 57.6032 32.8777 57.3612 33.0081L56.6593 35.7478L53.9 35.7723C53.6257 34.8264 53.4886 33.9132 53.4886 33.0326L53.5854 31.834C54.6181 31.4589 55.7847 31.1572 57.0853 30.9289C58.3826 30.7006 59.4266 30.5864 60.2173 30.5864C61.7825 30.5864 63.0169 31.1898 63.9205 32.3966C64.1141 32.6901 64.2109 33.4403 64.2109 34.647V39.5394C64.2109 40.0449 64.4046 40.2977 64.7918 40.2977L65.5906 40.2732L66.0746 40.2487ZM57.4822 39.7106C57.4822 40.1183 57.6032 40.4607 57.8453 40.738L59.3459 40.42V38.5854C58.1035 38.5854 57.4822 38.9604 57.4822 39.7106Z" fill="#DB6B97" />
                          </g>
                        </g>
                      </g>
                    </g>
                  </g>
                </g>
              </g>
              <path d="M46.1977 0C64.5631 0 79.4513 15.0467 79.4513 33.6074C79.4513 52.1682 64.5631 67.2149 46.1977 67.2149C32.034 67.2149 19.9385 58.2654 15.1452 45.6566H16.079C20.8274 57.7694 32.5226 66.3358 46.1977 66.3358C64.0828 66.3358 78.5815 51.6828 78.5815 33.6074C78.5815 15.532 64.0828 0.879068 46.1977 0.879068C32.5229 0.879068 20.8274 9.44543 16.079 21.5582H15.1452C19.9385 8.94948 32.0338 0 46.1977 0V0Z" fill="#DB6B97" />
            </g>
            <defs>
              <clipPath id="clip0_29_2879">
                <rect width="80" height="68" fill="white" />
              </clipPath>
              <clipPath id="clip1_29_2879">
                <rect width="65.7623" height="19.4959" fill="white" transform="translate(0.387573 23.8595)" />
              </clipPath>
              <clipPath id="clip2_29_2879">
                <rect width="65.7623" height="19.4959" fill="white" transform="translate(0.387573 23.8595)" />
              </clipPath>
              <clipPath id="clip3_29_2879">
                <rect width="65.7623" height="19.4959" fill="white" transform="translate(0.387573 23.8595)" />
              </clipPath>
              <clipPath id="clip4_29_2879">
                <rect width="65.7623" height="19.4959" fill="white" transform="translate(0.387573 23.8595)" />
              </clipPath>
              <clipPath id="clip5_29_2879">
                <rect width="65.7623" height="19.4959" fill="white" transform="translate(0.387573 23.8595)" />
              </clipPath>
              <clipPath id="clip6_29_2879">
                <rect width="65.7623" height="19.4959" fill="white" transform="translate(0.387573 23.8595)" />
              </clipPath>
              <clipPath id="clip7_29_2879">
                <rect width="65.7623" height="19.4959" fill="white" transform="translate(0.387573 23.8595)" />
              </clipPath>
            </defs>
          </svg>
        </div>
        <nav>
          <Navigation />
        </nav>
        <div className='flex gap-8'>
          <div className='flex gap-2 items-center text-textColorAcc'>
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M8 8C9.06087 8 10.0783 7.57857 10.8284 6.82843C11.5786 6.07828 12 5.06087 12 4C12 2.93913 11.5786 1.92172 10.8284 1.17157C10.0783 0.421427 9.06087 0 8 0C6.93913 0 5.92172 0.421427 5.17157 1.17157C4.42143 1.92172 4 2.93913 4 4C4 5.06087 4.42143 6.07828 5.17157 6.82843C5.92172 7.57857 6.93913 8 8 8ZM10.6667 4C10.6667 4.70724 10.3857 5.38552 9.88562 5.88562C9.38552 6.38572 8.70724 6.66667 8 6.66667C7.29276 6.66667 6.61448 6.38572 6.11438 5.88562C5.61428 5.38552 5.33333 4.70724 5.33333 4C5.33333 3.29276 5.61428 2.61448 6.11438 2.11438C6.61448 1.61428 7.29276 1.33333 8 1.33333C8.70724 1.33333 9.38552 1.61428 9.88562 2.11438C10.3857 2.61448 10.6667 3.29276 10.6667 4ZM16 14.6667C16 16 14.6667 16 14.6667 16H1.33333C1.33333 16 0 16 0 14.6667C0 13.3333 1.33333 9.33333 8 9.33333C14.6667 9.33333 16 13.3333 16 14.6667ZM14.6667 14.6613C14.6653 14.3333 14.4613 13.3467 13.5573 12.4427C12.688 11.5733 11.052 10.6667 8 10.6667C4.94667 10.6667 3.312 11.5733 2.44267 12.4427C1.53867 13.3467 1.336 14.3333 1.33333 14.6613H14.6667Z" fill="#DB6B97" />
            </svg>
            <div className='flex gap-1 font-semibold text-sm'>
              {user ?
                (
                  <div className='flex gap-2 items-center'>
                    <span>{user}</span>
                    <svg onClick={logOut} className='hover:cursor-pointer' width="16px" height="16px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <g clipPath="url(#clip0_1199_138)">
                        <path fillRule="evenodd" clipRule="evenodd" d="M2.11256 0.75C2.1001 0.75 2.08765 0.75031 2.07522 0.75093C1.49768 0.779719 0.955076 1.03617 0.566199 1.46413C0.181579 1.88741 -0.021668 2.44436 -0.000443399 3.01539V20.9848C-0.0213439 21.5557 0.181993 22.1124 0.566503 22.5356C0.955205 22.9634 1.49744 23.2199 2.0747 23.249C2.08731 23.2497 2.09993 23.25 2.11256 23.25H14.3856C14.398 23.25 14.4105 23.2497 14.4229 23.2491C15.0004 23.2203 15.543 22.9639 15.9321 22.5361C16.3169 22.1129 16.5204 21.556 16.4996 20.9849V16.5C16.4996 16.0858 16.1638 15.75 15.7496 15.75C15.3353 15.75 14.9996 16.0858 14.9996 16.5V21C14.9996 21.0045 14.9996 21.0089 14.9997 21.0134C14.9997 21.0164 14.9998 21.0194 14.9999 21.0225L15.0003 21.0338C15.0085 21.2153 14.9445 21.3926 14.8223 21.527C14.7035 21.6576 14.5392 21.7373 14.3635 21.75H2.13496C1.95943 21.7372 1.79527 21.6574 1.67665 21.5268C1.55454 21.3925 1.4906 21.2152 1.49879 21.0338C1.4993 21.0226 1.49956 21.0113 1.49956 21V3C1.49956 2.98854 1.49929 2.97709 1.49877 2.96564C1.49046 2.78437 1.55431 2.60719 1.67634 2.47288C1.79495 2.34235 1.95913 2.26267 2.13465 2.25H14.3635C14.5392 2.26268 14.7035 2.34241 14.8223 2.47302C14.9445 2.60741 15.0085 2.78473 15.0003 2.96619C14.9998 2.97745 14.9996 2.98873 14.9996 3V7.5C14.9996 7.91421 15.3353 8.25 15.7496 8.25C16.1638 8.25 16.4996 7.91421 16.4996 7.5V3.01514C16.5204 2.444 16.3169 1.88707 15.9321 1.46387C15.543 1.03605 15.0004 0.779717 14.4229 0.75093C14.4105 0.75031 14.398 0.75 14.3856 0.75H2.11256ZM18.9697 7.72367C19.2626 7.43077 19.7374 7.43077 20.0303 7.72367L23.7803 11.4737C23.8522 11.5456 23.9065 11.6285 23.9431 11.7169C23.9798 11.8053 24 11.9023 24 12.004C24 12.1959 23.9268 12.3879 23.7803 12.5343L20.0303 16.2843C19.7374 16.5772 19.2626 16.5772 18.9697 16.2843C18.6768 15.9914 18.6768 15.5166 18.9697 15.2237L21.4393 12.754H7.5C7.08579 12.754 6.75 12.4182 6.75 12.004C6.75 11.5898 7.08579 11.254 7.5 11.254H21.4393L18.9697 8.78433C18.6768 8.49143 18.6768 8.01656 18.9697 7.72367Z" fill="#767676" />
                      </g>
                      <defs>
                        <clipPath id="clip0_1199_138">
                          <rect width="24" height="24" fill="white" />
                        </clipPath>
                      </defs>
                    </svg>
                  </div>
                )
                :
                (
                  <>
                    <span><Link to='/avira_e-commerce/sing-in'>Login</Link></span>
                    <span>/</span>
                    <span><Link to='/avira_e-commerce/sing-up'>Register</Link></span>
                  </>
                )
              }
            </div>
          </div>
          <div className='flex gap-8 text-textColorAcc'>
            <a href="">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M14.6781 12.9298C15.8884 11.2782 16.4305 9.23057 16.1959 7.19648C15.9613 5.16238 14.9673 3.29186 13.4128 1.95915C11.8583 0.626437 9.85794 -0.0701841 7.81187 0.00865439C5.76581 0.0874929 3.82496 0.935976 2.37762 2.38435C0.930277 3.83273 0.0831823 5.77419 0.00580795 7.82031C-0.0715664 9.86643 0.626485 11.8663 1.96031 13.4199C3.29413 14.9734 5.16536 15.966 7.19963 16.1992C9.23389 16.4323 11.2812 15.8888 12.9319 14.6773H12.9306C12.9681 14.7273 13.0081 14.7748 13.0531 14.821L17.8654 19.6333C18.0998 19.8679 18.4178 19.9997 18.7493 19.9998C19.0809 19.9999 19.399 19.8683 19.6335 19.6339C19.8681 19.3996 19.9999 19.0816 20 18.75C20.0001 18.4185 19.8685 18.1004 19.6341 17.8659L14.8218 13.0536C14.7771 13.0083 14.7291 12.9665 14.6781 12.9286V12.9298ZM15.0006 8.125C15.0006 9.02781 14.8227 9.92177 14.4773 10.7559C14.1318 11.5899 13.6254 12.3478 12.987 12.9862C12.3486 13.6246 11.5907 14.1309 10.7567 14.4764C9.92258 14.8219 9.02862 14.9997 8.12582 14.9997C7.22301 14.9997 6.32905 14.8219 5.49497 14.4764C4.66089 14.1309 3.90302 13.6246 3.26464 12.9862C2.62626 12.3478 2.11987 11.5899 1.77438 10.7559C1.4289 9.92177 1.25108 9.02781 1.25108 8.125C1.25108 6.30171 1.97538 4.55309 3.26464 3.26383C4.55391 1.97456 6.30252 1.25026 8.12582 1.25026C9.94911 1.25026 11.6977 1.97456 12.987 3.26383C14.2763 4.55309 15.0006 6.30171 15.0006 8.125Z" fill="#DB6B97" />
              </svg>
            </a>
            <div className='flex gap-2 items-center'>
              <Link to="/avira_e-commerce/cart">
                <svg width="19" height="19" viewBox="0 0 19 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M0 0.875C0 0.70924 0.065848 0.550268 0.183058 0.433058C0.300269 0.315848 0.45924 0.25 0.625 0.25H2.5C2.63941 0.250039 2.77481 0.296688 2.88466 0.382531C2.99452 0.468374 3.07251 0.58848 3.10625 0.72375L3.6125 2.75H18.125C18.2168 2.75008 18.3074 2.77038 18.3904 2.80944C18.4735 2.8485 18.5469 2.90537 18.6055 2.976C18.6641 3.04664 18.7064 3.12931 18.7294 3.21815C18.7524 3.30698 18.7556 3.3998 18.7388 3.49L16.8638 13.49C16.8369 13.6332 16.7609 13.7626 16.6489 13.8557C16.5368 13.9488 16.3957 13.9999 16.25 14H5C4.85429 13.9999 4.71321 13.9488 4.60114 13.8557C4.48907 13.7626 4.41306 13.6332 4.38625 13.49L2.5125 3.50875L2.0125 1.5H0.625C0.45924 1.5 0.300269 1.43415 0.183058 1.31694C0.065848 1.19973 0 1.04076 0 0.875ZM3.8775 4L5.51875 12.75H15.7312L17.3725 4H3.8775ZM6.25 14C5.58696 14 4.95107 14.2634 4.48223 14.7322C4.01339 15.2011 3.75 15.837 3.75 16.5C3.75 17.163 4.01339 17.7989 4.48223 18.2678C4.95107 18.7366 5.58696 19 6.25 19C6.91304 19 7.54893 18.7366 8.01777 18.2678C8.48661 17.7989 8.75 17.163 8.75 16.5C8.75 15.837 8.48661 15.2011 8.01777 14.7322C7.54893 14.2634 6.91304 14 6.25 14ZM15 14C14.337 14 13.7011 14.2634 13.2322 14.7322C12.7634 15.2011 12.5 15.837 12.5 16.5C12.5 17.163 12.7634 17.7989 13.2322 18.2678C13.7011 18.7366 14.337 19 15 19C15.663 19 16.2989 18.7366 16.7678 18.2678C17.2366 17.7989 17.5 17.163 17.5 16.5C17.5 15.837 17.2366 15.2011 16.7678 14.7322C16.2989 14.2634 15.663 14 15 14ZM6.25 15.25C6.58152 15.25 6.89946 15.3817 7.13388 15.6161C7.3683 15.8505 7.5 16.1685 7.5 16.5C7.5 16.8315 7.3683 17.1495 7.13388 17.3839C6.89946 17.6183 6.58152 17.75 6.25 17.75C5.91848 17.75 5.60054 17.6183 5.36612 17.3839C5.1317 17.1495 5 16.8315 5 16.5C5 16.1685 5.1317 15.8505 5.36612 15.6161C5.60054 15.3817 5.91848 15.25 6.25 15.25ZM15 15.25C15.3315 15.25 15.6495 15.3817 15.8839 15.6161C16.1183 15.8505 16.25 16.1685 16.25 16.5C16.25 16.8315 16.1183 17.1495 15.8839 17.3839C15.6495 17.6183 15.3315 17.75 15 17.75C14.6685 17.75 14.3505 17.6183 14.1161 17.3839C13.8817 17.1495 13.75 16.8315 13.75 16.5C13.75 16.1685 13.8817 15.8505 14.1161 15.6161C14.3505 15.3817 14.6685 15.25 15 15.25Z" fill="#DB6B97" />
                </svg>
              </Link>
              <span>{cartCounter}</span>
            </div>
            <div className='flex gap-2 items-center'>
              <Link to='/avira_e-commerce/favorite'>
                <svg width="20" height="19" viewBox="0 0 20 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M9.99987 3.43506L9.10362 2.51381C6.99987 0.351311 3.14237 1.09756 1.74987 3.81631C1.09612 5.09506 0.948619 6.94131 2.14237 9.29756C3.29237 11.5663 5.68487 14.2838 9.99987 17.2438C14.3149 14.2838 16.7061 11.5663 17.8574 9.29756C19.0511 6.94006 18.9049 5.09506 18.2499 3.81631C16.8574 1.09756 12.9999 0.350061 10.8961 2.51256L9.99987 3.43506ZM9.99987 18.7501C-9.16638 6.08506 4.09862 -3.79994 9.77987 1.42881C9.85487 1.49756 9.92862 1.56881 9.99987 1.64256C10.0704 1.56888 10.1438 1.49799 10.2199 1.43006C15.8999 -3.80244 29.1661 6.08381 9.99987 18.7501Z" fill="#DB6B97" />
                </svg>
              </Link>
              <span>{favorite?.length}</span>
            </div>
          </div>
        </div>
      </section>
    </header>
  )
}

export default Header